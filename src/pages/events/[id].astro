---
import Layout from '../../layouts/Layout.astro';
import EventDetail from '../../components/EventDetail';
import { db } from '../../db';
import { events, eventItems, flavors } from '../../db/schema';
import { eq } from 'drizzle-orm';

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/events');
}

const event = await db.select().from(events).where(eq(events.id, parseInt(id))).get();

if (!event) {
  return Astro.redirect('/events');
}

const items = await db.select().from(eventItems).where(eq(eventItems.eventId, parseInt(id))).all();
const allFlavors = await db.select().from(flavors).all();
---

<Layout title={`${event.name} | Mighty Sweets Baking Co.`}>
  <EventDetail client:load event={event} items={items} availableFlavors={allFlavors} />
</Layout>
